UPDATE
  karimgcp14.STAGE_USECASE4.REAL_TRANSFORMATION
SET
  cust_id = TRIM( cust_id ),
  first_name = TRIM( first_name ),
  last_name = TRIM( last_name ),
  gender = TRIM( gender ),
  ip_address = TRIM( ip_address ),
  mac_id = TRIM( mac_id ),
  client_name = TRIM( client_name ),
  mail_id = TRIM( mail_id ),
  url_ = TRIM( url_ ),
  app_name = TRIM( app_name ),
  ph_number = TRIM( ph_number ),
  credit_card_band= TRIM( credit_card_band ),
  card_isu_date = TRIM( card_isu_date ),
  cur_code = TRIM( cur_code ),
  Frequency = TRIM( Frequency ),
  valid_card = TRIM( valid_card ),
  card_type = TRIM( card_type ),
  currency_code = TRIM( currency_code ),
  access_code = TRIM( access_code ),
  lst_trns_dt = TRIM( lst_trns_dt ),
  guid = TRIM( guid ),
  stock_sym = TRIM( stock_sym ),
  emp_role = TRIM( emp_role ),
  ITRAN_CAT_CDE = TRIM( ITRAN_CAT_CDE ),
  Ctry_code = TRIM( Ctry_code )
WHERE
  TRUE;




INSERT INTO
  karimgcp14.HISTORY_USECASE4.REAL_TRANSFORMATION
SELECT
  CAST(SHA512(cust_id) AS bytes) cust_id,
  first_name,
  last_name,
  CONCAT(concat(first_name,
      " "),last_name) AS fullname,
  (CASE
      WHEN gender="Male" THEN "M"
      WHEN gender="Female" THEN "F"
    ELSE
    "Not a valid gender"
  END
    ) AS gender,
  ip_address,
  mac_id,
  (SUBSTR(client_name,INSTR(client_name,'.')-1)) AS client_name,
  (MD5(mail_id)) AS mail_id,
  SUBSTR(url_,INSTR(url_,"//")+2,(INSTR(url_,"/",1,3))-(INSTR(url_,"//")+2)),
  app_name,
  (CONCAT("+91-",ph_number)) AS ph_number,
  credit_card_band,
  CAST(((CASE
          WHEN card_isu_date LIKE '_--_' THEN FORMAT_DATE('%Y-%m-%d', SAFE.PARSE_DATE('%m-%d-%Y', card_isu_date))
          WHEN card_isu_date LIKE '//_' THEN FORMAT_DATE('%Y-%m-%d', SAFE.PARSE_DATE('%m/%d/%Y', card_isu_date))
          WHEN card_isu_date LIKE '_//_' THEN FORMAT_DATE('%Y-%m-%d', SAFE.PARSE_DATE('%m/%d/%Y', card_isu_date))
      END
        )) AS DATE),
  cur_code,
  Frequency,
  valid_card,
  card_type,
  (CASE
      WHEN valid_card ="TRUE" AND card_type IS NOT NULL THEN "valid card"
    ELSE
    "not a valid card"
  END
    ) AS card_status,
  currency_code,
  access_code,
  CAST((FORMAT_TIMESTAMP('%F', TIMESTAMP_SECONDS(CAST(lst_trns_dt AS int64)))) AS DATE),
  guid,
  stock_sym,
  emp_role,
  CAST((CASE
        WHEN ITRAN_CAT_CDE IS NULL THEN "0"
      ELSE
      ITRAN_CAT_CDE
    END
      ) AS INT64),
  (COALESCE(Ctry_code, cur_code)) AS Ctry_code,
FROM
  karimgcp14.STAGE_USECASE4.REAL_TRANSFORMATION
WHERE
  REGEXP_CONTAINS(mac_id, r'^[0-9]') =TRUE
  AND url_ LIKE "____s%";
